<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="/static/style/show.css">
    <link rel="stylesheet" href="/static/js/dropzone.min.css">
    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="center">
                <ul>
                    <li class="topImage">
                        <a href="">
                            <img src="/static/images/houtui.png" alt="">
                        </a>
                    </li>
                    <li class="topText">
                        病例资料
                    </li>
                </ul>
            </div>
        </div>
        <div class="main">
            <div class="mainImage">
                <form action="" method="post" class="formDt" id="upload_form">
                    <div class="fileArea">
                        <input type="file" class="fileUpload">
                        <span>点击上传图片</span>
                    </div>
                </form>
            </div>
            <div class="mainTable">
                <h3 style="text-align: center;">北京市某某人民医院</h3>
                <table class="tab">
                	<tr>
                		<td class="border">姓名：张三</td>
                		<td class="border">性别：男</td>
                		<td class="border">年龄：22</td>
                	</tr>
                	<tr>
                		<td>科室：呼吸科</td>
                		<td></td>
                		<td></td>
                	</tr>
                </table>
                <table cellspacing="0" class="table1">
                    <caption style="text-align: left;padding-left:10px;">匹配的字典</caption>
                    <th style="text-align: left;">序号</th>
                    <th style="text-align: left;">项目</th>
                    <th style="text-align: left;">结果</th>
                    <th style="text-align: left;">参考值</th>
                </table>
                <table cellspacing="0" class="table2">
                    <caption style="text-align: left;padding-left: 10px;"x>未匹配的信息</caption>
                </table>
            </div>
        </div>
        <div class="footer">
            <div class="bottom">
            </div>
            <div class="hide"></div>
        </div>
    </div>
    <script src="/static/js/jquery.min.js"></script>
    <!-- <script src="../js/imageUpload.js"></script> -->
    <script>
          function convertBase64UrlToBlob(urlData, filetype){
        //去掉url的头，并转换为byte
        var bytes = window.atob(urlData.split(',')[1]);
        
        //处理异常,将ascii码小于0的转换为大于0
        var ab = new ArrayBuffer(bytes.length);
        var ia = new Uint8Array(ab);
        var i;
        for (i = 0; i < bytes.length; i++) {
            ia[i] = bytes.charCodeAt(i);
        }

        return new Blob([ab], {type : filetype});
    }

$('.fileUpload').on('change', function (e) {
        var input = $input.get(0);
        var files = input.files || [];
        if (files.length === 0) {
            return;
        }

        console.log('选中 ' + files.length + ' 个文件');

        // 遍历选中的文件，预览、上传
        $.each(files, function (key, file) {
            var filename = file.name || '';
            var fileType = file.type || '';
            
            var reader = new FileReader();
            // onload事件
            reader.onload = function (e) {
                var base64 = e.target.result || this.result;
                var formData = new FormData();
                
                formData.append("upload_file", convertBase64UrlToBlob(base64, fileType), filename);
                var xhr = new XMLHttpRequest();
                // 开始上传
                xhr.open('POST', "http://59.110.66.146:8088/api/ocr/index/", true);
                
                // 发送数据
                xhr.send(formData);

            };
            
            reader.readAsDataURL(file);
        });
})
    </script>
</body>

</html>
